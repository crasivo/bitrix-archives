name: Manual publish PHP script

on:
  workflow_dispatch:
    inputs:
      script_name:
        description: 'Script name'
        required: true
        type: choice
        options: [restore.php,bitrixsetup.php,bitrix_server_test.php]

jobs:
  publish_script:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      - name: Define global variables
        run: |
          echo "RELEASE_TAG=${{ github.event.inputs.script_name }}-$(date +'%Y%m%d')" >> $GITHUB_ENV;
          echo "RELEASE_DATE=$(date +'%d.%m.%Y')" >> $GITHUB_ENV;
      - name: Download script & create manifest
        id: analysis
        run: |
          ./bin/download-script.sh ${{ github.event.inputs.script_name }}
        env:
          GITHUB_RELEASE_DATE: ${{ env.RELEASE_DATE }}
          GITHUB_RELEASE_TAG: ${{ env.RELEASE_TAG }}
      - name: Create GitHub Release
        uses: softprops/action-gh-release@v2
        with:
          tag_name: ${{ env.RELEASE_TAG }}
          name: "Script: ${{ github.event.inputs.script_name }} (${{ env.RELEASE_DATE }})"
          prerelease: true # hide release
          body: |
            ## üì¶ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–µ–ª–∏–∑–µ

            –î–∞–Ω–Ω—ã–π —Ä–µ–ª–∏–∑ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ–∞–π–ª `${{ github.event.inputs.script_name }}`, –∫–æ—Ç–æ—Ä—ã–π –±—ã–ª –∑–∞–≥—Ä—É–∂–µ–Ω —Å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Å–∞–π—Ç–∞ 1–°-–ë–∏—Ç—Ä–∏–∫—Å.

            **File meta:**
            - –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞: `${{ github.event.inputs.script_name }}`
            - MD5: `${{ env.BITRIX_META_SCRIPT_MD5 }}`
            - SHA1: `${{ env.BITRIX_META_SCRIPT_SHA1 }}`
            - SHA256: `${{ env.BITRIX_META_SCRIPT_SHA256 }}`
          files: |
            ${{ env.BITRIX_MANIFEST_PATH }}
            ${{ env.BITRIX_META_SCRIPT_PATH }}
            ${{ env.BITRIX_META_SCRIPT_PATH }}.md5
            ${{ env.BITRIX_META_SCRIPT_PATH }}.sha1
            ${{ env.BITRIX_META_SCRIPT_PATH }}.sha256
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
