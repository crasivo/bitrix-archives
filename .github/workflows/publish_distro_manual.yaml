name: Manual publish any distro

on:
  workflow_dispatch:
    inputs:
      distro_code:
        description: 'Distribution'
        required: true
        default: 'start'
        type: choice
        options: [start,standard,business,small_business,business_cluster,business_cluster_postgresql,bitrix24,bitrix24_shop,bitrix24_enterprise]

jobs:
  publish_distro:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      - name: Download distros & create manifest
        id: analysis
        run: |
          chmod +x ./bin/download-distro.sh
          ./bin/download-distro.sh ${{ github.event.inputs.distro_code }}
      - name: Create GitHub Release
        uses: softprops/action-gh-release@v2
        if: env.SKIP_PUBLISH != 'true' && env.BITRIX_MAIN_VERSION != ''
        with:
          tag_name: ${{ github.event.inputs.distro_code }}-${{ env.BITRIX_MAIN_VERSION }}
          name: "Distro: ${{ github.event.inputs.distro_code }} v${{ env.BITRIX_MAIN_VERSION }}"
          body: |
            ## üì¶ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–µ–ª–∏–∑–µ

            –î–∞–Ω–Ω—ã–π —Ä–µ–ª–∏–∑ —Å–æ–¥–µ—Ä–∂–∏—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –∞—Ä—Ö–∏–≤—ã –¥–ª—è —Ä–µ–¥–∞–∫—Ü–∏–∏ `${{ github.event.inputs.distro_code }}` 1C-Bitrix,
            –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã —Å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Å–∞–π—Ç–∞ 1–°-–ë–∏—Ç—Ä–∏–∫—Å.

            **Kernel (main):**
            - Version: `${{ env.BITRIX_MAIN_VERSION }}`
            - Release date: `${{ env.BITRIX_MAIN_VERSION_DATE }}`

            **Tar meta:**
            - Filename: `${{ github.event.inputs.distro_code }}.tar.gz`
            - MD5: `${{ env.BITRIX_META_TAR_MD5 }}`
            - SHA1: `${{ env.BITRIX_META_TAR_SHA1 }}`
            - SHA256: `${{ env.BITRIX_META_TAR_SHA256 }}`
            - Size: ${{ env.BITRIX_META_TAR_SIZE_MB }} Mb

            **Zip meta:**
            - Filename: `${{ github.event.inputs.distro_code }}.zip`
            - MD5: `${{ env.BITRIX_META_ZIP_MD5 }}`
            - SHA1: `${{ env.BITRIX_META_ZIP_SHA1 }}`
            - SHA256: `${{ env.BITRIX_META_ZIP_SHA256 }}`
            - Size: ${{ env.BITRIX_META_ZIP_SIZE_MB }} Mb

            –†–µ–ª–∏–∑ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ–∞–π–ª <a href="https://github.com/${{ github.repository }}/releases/download/${{ env.RELEASE_TAG }}/manifest.json">manifest.json</a>, –≤ –∫–æ—Ç–æ—Ä–æ–º —Å–æ–¥–µ—Ä–∂–∏—Ç—å—Å—è –≤—Å—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –≤–∫–ª—é—á–∞—è –æ—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–∞-–¥–∞–Ω–Ω—ã–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∞—Ä—Ö–∏–≤–∞.

            ---
            –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–∏ —á–µ—Ä–µ–∑ GitHub Action.
          files: |
            ${{ env.BITRIX_MANIFEST_FILEPATH }}
            ${{ env.BITRIX_META_ZIP_FILEPATH }}
            ${{ env.BITRIX_META_ZIP_FILEPATH }}.*
            ${{ env.BITRIX_META_TAR_FILEPATH }}
            ${{ env.BITRIX_META_TAR_FILEPATH }}.*
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
